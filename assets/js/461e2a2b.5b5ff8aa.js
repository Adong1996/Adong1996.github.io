"use strict";(self.webpackChunkakara=self.webpackChunkakara||[]).push([[3092],{3905:function(e,n,t){t.d(n,{Zo:function(){return p},kt:function(){return h}});var a=t(7294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var i=a.createContext({}),c=function(e){var n=a.useContext(i),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},p=function(e){var n=c(e.components);return a.createElement(i.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},d=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,o=e.originalType,i=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),d=c(t),h=r,m=d["".concat(i,".").concat(h)]||d[h]||u[h]||o;return t?a.createElement(m,l(l({ref:n},p),{},{components:t})):a.createElement(m,l({ref:n},p))}));function h(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var o=t.length,l=new Array(o);l[0]=d;var s={};for(var i in n)hasOwnProperty.call(n,i)&&(s[i]=n[i]);s.originalType=e,s.mdxType="string"==typeof e?e:r,l[1]=s;for(var c=2;c<o;c++)l[c]=t[c];return a.createElement.apply(null,l)}return a.createElement.apply(null,t)}d.displayName="MDXCreateElement"},5711:function(e,n,t){t.r(n),t.d(n,{assets:function(){return p},contentTitle:function(){return i},default:function(){return h},frontMatter:function(){return s},metadata:function(){return c},toc:function(){return u}});var a=t(7462),r=t(3366),o=(t(7294),t(3905)),l=["components"],s={},i=void 0,c={unversionedId:"javascript/AJAX",id:"javascript/AJAX",title:"AJAX",description:"| readyState | \u63cf\u8ff0                            |",source:"@site/docs/javascript/AJAX.md",sourceDirName:"javascript",slug:"/javascript/AJAX",permalink:"/blog/docs/javascript/AJAX",editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/javascript/AJAX.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Generator",permalink:"/blog/docs/javascript/Generator"},next:{title:"Fetch",permalink:"/blog/docs/javascript/Fetch"}},p={},u=[{value:"With Callback",id:"with-callback",level:2},{value:"With Promise",id:"with-promise",level:2},{value:"With Generator",id:"with-generator",level:2},{value:"With Generator + Co",id:"with-generator--co",level:2},{value:"With Async",id:"with-async",level:2},{value:"Axios",id:"axios",level:2}],d={toc:u};function h(e){var n=e.components,t=(0,r.Z)(e,l);return(0,o.kt)("wrapper",(0,a.Z)({},d,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"let xhr = new XMLHttpRequest()\nxhr.onreadystatechange = function () {\n    if (xhr.readyState === 4) {\n\n    }\n}\n\nxhr.onprogress = function (event) {\n    if (event.lengthComputable) {\n        var complete = (event.loaded / event.total * 100 | 0);\n        progress.value = complete;\n    }\n}\nxhr.open('get', '/getInfo')\n// \u8bbe\u7f6e\u8bf7\u6c42\u5934\nxhr.setRequestHeader()\n// \u8d85\u65f6\u63a7\u5236\nxhr.timeout =\nxhr.ontimeout = function () {}\n// \u4e2d\u6b62\u8bf7\u6c42\nxhr.abort()\n// \u53d1\u9001\u8bf7\u6c42\nxhr.send()\n")),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"readyState"),(0,o.kt)("th",{parentName:"tr",align:null},"\u63cf\u8ff0"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"0"),(0,o.kt)("td",{parentName:"tr",align:null},"XHR\u5df2\u7ecf\u521b\u5efa\uff0c\u4f46\u672a\u8c03\u7528open()\u65b9\u6cd5")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"1"),(0,o.kt)("td",{parentName:"tr",align:null},"open()\u65b9\u6cd5\u5df2\u7ecf\u88ab\u8c03\u7528")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"2"),(0,o.kt)("td",{parentName:"tr",align:null},"send() \u65b9\u6cd5\u5df2\u7ecf\u88ab\u8c03\u7528")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"3"),(0,o.kt)("td",{parentName:"tr",align:null},"\u6b63\u5728\u63a5\u6536\u54cd\u5e94\u7684\u5185\u5bb9")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"4"),(0,o.kt)("td",{parentName:"tr",align:null},"\u6210\u529f\u63a5\u6536\u5230\u54cd\u5e94")))),(0,o.kt)("h2",{id:"with-callback"},"With Callback"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"const Ajax = ({\n    method = 'get',\n    url = '/',\n    data,\n    async = true\n}, callback) => {\n    let xhr = new XMLHttpRequest()\n    xhr.onreadystatechange = () => {\n        if (xhr.readyState === 4 && xhr.status === 200) {\n            let res = JSON.parse(xhr.responseText)\n            callback(res)\n        }\n    }\n    xhr.open(method, url, async)\n    if (method === 'get') {\n        xhr.send()\n    }\n    if (method === 'post') {\n        let type = typeof data\n        let header\n        if (type === 'string') {\n            header = 'application/x-www-form-urlencoded'\n        }\n        else {\n            header = 'application/json'\n            data = JSON.stringify(data)\n        }\n        xhr.setRequestHeader('Content-type', header)\n        xhr.send(data)\n    }\n}\n\nAjax.get = (url, callback) => {\n    return Ajax({\n        url\n    }, callback)\n}\n\n\nAjax.post = function (url, data, callback) {\n    return Ajax({\n        method: 'post',\n        url,\n        data,\n    }, callback)\n}\n\nAjax.get('http://localhost:3000/getData', (res) => {\n    console.log(res)\n})\n")),(0,o.kt)("h2",{id:"with-promise"},"With Promise"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"const Ajax = ({\n    method = 'get',\n    url = '/',\n    data,\n    async = true\n}) => {\n    return new Promise((resolve, reject) => {\n        let xhr = new XMLHttpRequest()\n        xhr.onreadystatechange = () => {\n            if (xhr.readyState === 4 && xhr.status === 200) {\n                let res = JSON.parse(xhr.responseText)\n                resolve(res)\n            }\n        }\n        xhr.open(method, url, async)\n        if (method === 'get') {\n            xhr.send()\n        }\n        if (method === 'post') {\n            let type = typeof data\n            let header\n            if (type === 'string') {\n                header = 'application/x-www-form-urlencoded'\n            }\n            else {\n                header = 'application/json'\n                data = JSON.stringify(data)\n            }\n            xhr.setRequestHeader('Content-type', header)\n            xhr.send(data)\n        }\n    })\n}\n\nAjax.get = (url) => {\n    return Ajax({\n        url\n    })\n}\n\n\n\nAjax.get('http://localhost:3000/getData')\n    .then((data) => {\n        console.log(data)\n    })\n")),(0,o.kt)("h2",{id:"with-generator"},"With Generator"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"const Ajax = ({\n    method = 'get',\n    url = '/',\n    data,\n    async = true\n}) => {\n    return new Promise((resolve, reject) => {\n        let xhr = new XMLHttpRequest()\n        xhr.onreadystatechange = () => {\n            if (xhr.readyState === 4 && xhr.status === 200) {\n                let res = JSON.parse(xhr.responseText)\n                resolve(res)\n            }\n        }\n        xhr.open(method, url, async)\n        if (method === 'get') {\n            xhr.send()\n        }\n        if (method === 'post') {\n            let type = typeof data\n            let header\n            if (type === 'string') {\n                header = 'application/x-www-form-urlencoded'\n            }\n            else {\n                header = 'application/json'\n                data = JSON.stringify(data)\n            }\n            xhr.setRequestHeader('Content-type', header)\n            xhr.send(data)\n        }\n    })\n}\n\nAjax.get = (url) => {\n    return Ajax({\n        url\n    })\n}\n\n\nfunction* use() {\n    let data = yield Ajax.get('http://localhost:3000/getData')\n    console.log(data)\n}\n\nlet obj = use()\nobj.next().value.then((res) => {\n    obj.next(res)\n})\n")),(0,o.kt)("h2",{id:"with-generator--co"},"With Generator + Co"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"const Ajax = ({\n    method = 'get',\n    url = '/',\n    data,\n    async = true\n}) => {\n    return new Promise((resolve, reject) => {\n        let xhr = new XMLHttpRequest()\n        xhr.onreadystatechange = () => {\n            if (xhr.readyState === 4 && xhr.status === 200) {\n                let res = JSON.parse(xhr.responseText)\n                resolve(res)\n            }\n        }\n        xhr.open(method, url, async)\n        if (method === 'get') {\n            xhr.send()\n        }\n        if (method === 'post') {\n            let type = typeof data\n            let header\n            if (type === 'string') {\n                header = 'application/x-www-form-urlencoded'\n            }\n            else {\n                header = 'application/json'\n                data = JSON.stringify(data)\n            }\n            xhr.setRequestHeader('Content-type', header)\n            xhr.send(data)\n        }\n    })\n}\n\nAjax.get = (url) => {\n    return Ajax({\n        url\n    })\n}\n\n\n\nfunction* use() {\n    let data = yield Ajax.get('http://localhost:3000/getData')\n    console.log(data)\n}\n\nco(use)\n")),(0,o.kt)("p",null,"Co\u6a21\u5757\u7684\u539f\u7406\u7c7b\u4f3c\u5982\u4e0b"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"function co(gen){\n  var g = gen();\n\n  function next(data){\n    var result = g.next(data);\n    if (result.done) return result.value;\n    result.value.then(function(data){\n      next(data);\n    });\n  }\n\n  next();\n}\n")),(0,o.kt)("h2",{id:"with-async"},"With Async"),(0,o.kt)("p",null,"\u5176\u5b9easync\u53ef\u4ee5\u770b\u6210Generator + co\u7684\u96c6\u6210\uff0c\u4e0d\u540c\u7684\u662f\u5173\u952e\u5b57\u5206\u522b\u7528async\u548cawait\u4ee3\u66ff\u4e86*\u548cyield\uff0c\u66f4\u52a0\u7684\u8bed\u4e49\u5316\u3002\u9664\u6b64\u4e4b\u5916\uff0casync\u51fd\u6570\u4f1a\u8fd4\u56de\u4e00\u4e2aPromise\u5bf9\u8c61\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"const Ajax = ({\n    method = 'get',\n    url = '/',\n    data,\n    async = true\n}) => {\n    return new Promise((resolve, reject) => {\n        let xhr = new XMLHttpRequest()\n        xhr.onreadystatechange = () => {\n            if (xhr.readyState === 4 && xhr.status === 200) {\n                let res = JSON.parse(xhr.responseText)\n                resolve(res)\n            }\n        }\n        xhr.open(method, url, async)\n        if (method === 'get') {\n            xhr.send()\n        }\n        if (method === 'post') {\n            let type = typeof data\n            let header\n            if (type === 'string') {\n                header = 'application/x-www-form-urlencoded'\n            }\n            else {\n                header = 'application/json'\n                data = JSON.stringify(data)\n            }\n            xhr.setRequestHeader('Content-type', header)\n            xhr.send(data)\n        }\n    })\n\n}\n\nAjax.get = (url) => {\n    return Ajax({url})\n}\n\n\nasync function use() {\n    let data = await Ajax.get('http://localhost:3000/getData')\n    console.log(data)\n}\n\nuse()\n")),(0,o.kt)("p",null,"\u8865\u5145\u4e00\u4e2a\u5e38\u89c1\u7684\u95ee\u9898"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"async function A() { // \u8fd9\u4ee3\u7801\u4e00\u770b\u5c31\u6709\u95ee\u9898\n    let arr = []\n    await fetch()\n    arr.forEach(async item => { \n        await fetch(item)\n    })\n    console.log(1)\n}\n\nasync function A() { // \u5e94\u8be5\u5199\u6210\u8fd9\u6837\n    let arr = []\n    let pArr = []\n    await fetch()\n    for (let item of arr) {\n        pArr.push(fetch(item))\n    }    \n    const data = await Promise.all(pArr)\n}\n")),(0,o.kt)("h2",{id:"axios"},"Axios"),(0,o.kt)("p",null,"\u53ef\u4ee5\u4f7f\u7528\u73b0\u6210\u7684AJAX\u5e93Axios\uff0c\u5f53\u7136\u4e5f\u53ef\u4ee5\u91c7\u7528\u4e0b\u4e00\u8282\u4ecb\u7ecd\u7684\u6d4f\u89c8\u5668\u81ea\u5e26\u7684Fetch\u6765\u53d1\u8bf7\u6c42"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"axios({\n    method: 'post',\n    url: '/user/12345',\n    data: {\n        firstName: 'Fred',\n        lastName: 'Flintstone'\n    }\n})\n.then(function (response) {\n    console.log(response);\n})\n.catch(function (error) {\n    console.log(error);\n});\n")))}h.isMDXComponent=!0}}]);